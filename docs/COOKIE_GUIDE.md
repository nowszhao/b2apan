# Cookie è·å–æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•è·å–ç™¾åº¦ç½‘ç›˜å’Œé˜¿é‡Œäº‘ç›˜çš„ Cookie æˆ– Tokenã€‚

## ğŸ“Œ æ¨èæ–¹å¼

- **ç™¾åº¦ç½‘ç›˜**ï¼šä½¿ç”¨ Cookieï¼ˆæœ€ç®€å•ï¼‰
- **é˜¿é‡Œäº‘ç›˜**ï¼šä½¿ç”¨ Refresh Tokenï¼ˆæœ€ç¨³å®šï¼‰

---

## ğŸ”µ ç™¾åº¦ç½‘ç›˜ Cookie è·å–æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šChrome æµè§ˆå™¨ï¼ˆæ¨èï¼‰

1. **ç™»å½•ç™¾åº¦ç½‘ç›˜**
   - æ‰“å¼€ https://pan.baidu.com
   - ç™»å½•ä½ çš„è´¦å·

2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - æŒ‰ `F12` æˆ–å³é”®ç‚¹å‡»é¡µé¢ â†’ é€‰æ‹©"æ£€æŸ¥"
   - åˆ‡æ¢åˆ° `Network`ï¼ˆç½‘ç»œï¼‰æ ‡ç­¾

3. **åˆ·æ–°é¡µé¢**
   - æŒ‰ `F5` åˆ·æ–°é¡µé¢
   - åœ¨ Network æ ‡ç­¾ä¸­ä¼šçœ‹åˆ°å¾ˆå¤šè¯·æ±‚

4. **æŸ¥æ‰¾è¯·æ±‚**
   - åœ¨ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ä¸­è¾“å…¥ `list` æˆ– `api`
   - ç‚¹å‡»ä»»æ„ä¸€ä¸ªè¯·æ±‚ï¼ˆé€šå¸¸æ˜¯ `list?...` å¼€å¤´çš„ï¼‰

5. **å¤åˆ¶ Cookie**
   - åœ¨å³ä¾§é¢æ¿æ‰¾åˆ° `Request Headers`ï¼ˆè¯·æ±‚å¤´ï¼‰
   - æ‰¾åˆ° `Cookie:` è¿™ä¸€è¡Œ
   - å¤åˆ¶æ•´ä¸ª Cookie å€¼ï¼ˆä» `BDUSS=` å¼€å§‹åˆ°æœ«å°¾ï¼‰

**Cookie ç¤ºä¾‹ï¼š**
```
BDUSS=xxxxxxxxxx; STOKEN=xxxxxxxxxx; ...
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨æµè§ˆå™¨æ’ä»¶

1. å®‰è£… Chrome æ’ä»¶ "EditThisCookie" æˆ– "Cookie-Editor"
2. ç™»å½•ç™¾åº¦ç½‘ç›˜åï¼Œç‚¹å‡»æ’ä»¶å›¾æ ‡
3. å¯¼å‡ºæ‰€æœ‰ Cookieï¼ˆé€‰æ‹© Netscape æ ¼å¼æˆ– JSON æ ¼å¼ï¼‰
4. å°†å¯¼å‡ºçš„å†…å®¹æ•´ç†æˆ `key=value; key=value` æ ¼å¼

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

```bash
# ä½¿ç”¨ curl è·å–ï¼ˆéœ€è¦å…ˆæ‰‹åŠ¨ç™»å½•è·å–ä¸€æ¬¡ Cookieï¼‰
curl 'https://pan.baidu.com/api/list?dir=/' \
  -H 'Cookie: ä½ çš„Cookie' \
  -H 'User-Agent: Mozilla/5.0'
```

---

## ğŸŸ¢ é˜¿é‡Œäº‘ç›˜ Refresh Token è·å–æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šé€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆæ¨èï¼‰

1. **ç™»å½•é˜¿é‡Œäº‘ç›˜**
   - æ‰“å¼€ https://www.aliyundrive.com
   - ç™»å½•ä½ çš„è´¦å·

2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
   - åˆ‡æ¢åˆ° `Application`ï¼ˆåº”ç”¨ç¨‹åºï¼‰æ ‡ç­¾
   - å¦‚æœæ²¡æœ‰ï¼Œå¯èƒ½å« `Storage`ï¼ˆå­˜å‚¨ï¼‰

3. **æŸ¥æ‰¾ Token**
   - åœ¨å·¦ä¾§å±•å¼€ `Local Storage`
   - ç‚¹å‡» `https://www.aliyundrive.com`
   - åœ¨å³ä¾§æ‰¾åˆ° `token` ç›¸å…³çš„é”®

4. **å¤åˆ¶ Refresh Token**
   - æ‰¾åˆ°ç±»ä¼¼ `token` æˆ– `refresh_token` çš„é”®
   - å¤åˆ¶å¯¹åº”çš„å€¼ï¼ˆé€šå¸¸æ˜¯ä¸€é•¿ä¸²å­—ç¬¦ï¼‰

**Token ç¤ºä¾‹ï¼š**
```
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI...
```

### æ–¹æ³•äºŒï¼šé€šè¿‡ Network æŠ“åŒ…

1. **æ‰“å¼€å¼€å‘è€…å·¥å…·**
   - æŒ‰ `F12`ï¼Œåˆ‡æ¢åˆ° `Network` æ ‡ç­¾

2. **åˆ·æ–°é¡µé¢**
   - æŒ‰ `F5` åˆ·æ–°é¡µé¢

3. **æŸ¥æ‰¾ API è¯·æ±‚**
   - åœ¨ Filter ä¸­è¾“å…¥ `token` æˆ– `refresh`
   - æ‰¾åˆ°åŒ…å« `refresh_token` çš„è¯·æ±‚

4. **æŸ¥çœ‹å“åº”**
   - ç‚¹å‡»è¯·æ±‚ï¼ŒæŸ¥çœ‹ `Response`ï¼ˆå“åº”ï¼‰æˆ– `Preview`ï¼ˆé¢„è§ˆï¼‰
   - æ‰¾åˆ° `refresh_token` å­—æ®µå¹¶å¤åˆ¶

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·

ä½¿ç”¨ [aliyunpan](https://github.com/tickstep/aliyunpan) å‘½ä»¤è¡Œå·¥å…·ï¼š

```bash
# å®‰è£…
wget https://github.com/tickstep/aliyunpan/releases/download/v0.2.8/aliyunpan-v0.2.8-linux-amd64.zip
unzip aliyunpan-v0.2.8-linux-amd64.zip
chmod +x aliyunpan

# ç™»å½•
./aliyunpan login

# æŸ¥çœ‹ token
./aliyunpan token
```

---

## ğŸ“ é…ç½®æ–‡ä»¶å¡«å†™

### æ¨èé…ç½®ï¼ˆä½¿ç”¨ Cookie å’Œ Refresh Tokenï¼‰

```json
{
  "baidu": {
    "cookie": "BDUSS=ä½ çš„BDUSSå€¼; STOKEN=ä½ çš„STOKENå€¼; ..."
  },
  "aliyun": {
    "refresh_token": "ä½ çš„refresh_tokenå€¼"
  },
  "sync_tasks": [
    {
      "baidu_folder": "/æˆ‘çš„æ–‡ä»¶å¤¹",
      "aliyun_folder": "/å¤‡ä»½/æˆ‘çš„æ–‡ä»¶å¤¹"
    }
  ],
  "temp_dir": "/tmp/pan_sync",
  "max_workers": 3
}
```

### ç®€åŒ–é…ç½®ï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰

```json
{
  "baidu_cookie": "ä½ çš„ç™¾åº¦ç½‘ç›˜Cookie",
  "aliyun_refresh_token": "ä½ çš„é˜¿é‡Œäº‘ç›˜refresh_token",
  "sync_tasks": [
    {
      "baidu_folder": "/æ–‡æ¡£",
      "aliyun_folder": "/å¤‡ä»½/æ–‡æ¡£"
    }
  ]
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### Cookie/Token å®‰å…¨

1. **ä¸è¦åˆ†äº«**ï¼šCookie å’Œ Token ç›¸å½“äºä½ çš„è´¦å·å¯†ç ï¼Œä¸è¦åˆ†äº«ç»™ä»–äºº
2. **å®šæœŸæ›´æ¢**ï¼šå»ºè®®å®šæœŸæ›´æ–° Cookie/Token
3. **å®‰å…¨å­˜å‚¨**ï¼šé…ç½®æ–‡ä»¶æƒé™è®¾ç½®ä¸ºä»…è‡ªå·±å¯è¯»

```bash
chmod 600 config.json
```

### Cookie/Token æœ‰æ•ˆæœŸ

- **ç™¾åº¦ç½‘ç›˜ Cookie**ï¼šé€šå¸¸æœ‰æ•ˆæœŸ 30 å¤©å·¦å³
- **é˜¿é‡Œäº‘ç›˜ Refresh Token**ï¼šé•¿æœŸæœ‰æ•ˆï¼Œä¼šè‡ªåŠ¨åˆ·æ–°

### å¤±æ•ˆå¤„ç†

å¦‚æœæç¤ºè®¤è¯å¤±è´¥ï¼š

1. é‡æ–°è·å– Cookie/Token
2. æ£€æŸ¥æ˜¯å¦å¤åˆ¶å®Œæ•´
3. ç¡®è®¤è´¦å·æ˜¯å¦æ­£å¸¸ç™»å½•

---

## ğŸ” æ•…éšœæ’æŸ¥

### ç™¾åº¦ç½‘ç›˜è®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š** `ç™¾åº¦äº‘ç›˜åˆ—è¡¨è·å–å¤±è´¥`

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤ Cookie æ˜¯å¦åŒ…å« `BDUSS`
2. æ£€æŸ¥ Cookie æ˜¯å¦è¿‡æœŸï¼ˆé‡æ–°ç™»å½•è·å–ï¼‰
3. ç¡®è®¤è´¦å·æ˜¯å¦æ­£å¸¸

### é˜¿é‡Œäº‘ç›˜è®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š** `é˜¿é‡Œäº‘ç›˜ä»¤ç‰Œåˆ·æ–°å¤±è´¥`

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤ refresh_token æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ token æ ¼å¼ï¼ˆåº”è¯¥æ˜¯ JWT æ ¼å¼ï¼‰
3. é‡æ–°ä»æµè§ˆå™¨è·å–

### Cookie æ ¼å¼é”™è¯¯

**æ­£ç¡®æ ¼å¼ï¼š**
```
key1=value1; key2=value2; key3=value3
```

**é”™è¯¯æ ¼å¼ï¼š**
```
key1: value1
key2: value2
```

---

## ğŸ’¡ é«˜çº§æŠ€å·§

### è‡ªåŠ¨åŒ–è·å– Cookie

å¯ä»¥ä½¿ç”¨ Selenium æˆ– Playwright è‡ªåŠ¨åŒ–ç™»å½•å¹¶è·å– Cookieï¼š

```python
from selenium import webdriver

driver = webdriver.Chrome()
driver.get('https://pan.baidu.com')

# æ‰‹åŠ¨ç™»å½•å
cookies = driver.get_cookies()
cookie_str = '; '.join([f"{c['name']}={c['value']}" for c in cookies])
print(cookie_str)
```

### ä½¿ç”¨ç¯å¢ƒå˜é‡

ä¸ºäº†å®‰å…¨ï¼Œå¯ä»¥å°†æ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼š

```bash
export BAIDU_COOKIE="ä½ çš„Cookie"
export ALIYUN_TOKEN="ä½ çš„Token"
```

ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­å¼•ç”¨ï¼š

```json
{
  "baidu_cookie": "${BAIDU_COOKIE}",
  "aliyun_refresh_token": "${ALIYUN_TOKEN}"
}
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ `sync.log` æ—¥å¿—æ–‡ä»¶
2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
3. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
4. å‚è€ƒ README.md ä¸­çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
